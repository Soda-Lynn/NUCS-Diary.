<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>NUCS Diary - Write Post</title>

<!-- Quill.js styles -->
<link href="https://cdn.quilljs.com/1.3.7/quill.snow.css" rel="stylesheet">
<style>
  #editor { height: 300px; background: white; padding: 10px; }
  .toolbar-container { margin-bottom: 10px; }
  button { margin-right: 5px; }
</style>
</head>
<body>

<h1>NUCS Diary - Write Post</h1>

<!-- Quill editor container -->
<div id="editor"></div>

<div style="margin-top:10px;">
  <button onclick="publish()">Publish</button>
</div>

<!-- Quill.js script -->
<script src="https://cdn.quilljs.com/1.3.7/quill.js"></script>
<script>
// Initialize Quill editor
const quill = new Quill('#editor', {
  theme: 'snow',
  placeholder: 'Write your diary post...',
  modules: {
    toolbar: [
      ['bold', 'italic', 'underline', 'strike'],
      [{ 'header': [1, 2, 3, false] }],
      ['link', 'image'],
      [{ 'list': 'ordered'}, { 'list': 'bullet' }],
      ['clean']
    ]
  }
});

// Publish function
async function publish() {
  const html = quill.root.innerHTML;
  if (!html || html === '<p><br></p>') return alert("Write something!");

  try {
    const res = await fetch("/publish", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ content: html })
    });

    if (!res.ok) {
      const err = await res.json();
      return alert("Publish failed: " + (err.error || res.status));
    }

    const data = await res.json();
    window.location.href = window.location.origin + data.url;
  } catch (e) {
    alert("Publish error: " + e.message);
  }
}
</script>

</body>
</html>
